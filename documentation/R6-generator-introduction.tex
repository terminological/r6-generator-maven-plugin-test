\documentclass[
]{jss}

\usepackage[utf8]{inputenc}

\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

\author{
Robert Challen\\University of Exeter
}
\title{R6 Generator Maven Plugin: Bridging \proglang{Java} and \proglang{R6}
for Package Development}

\Plainauthor{Robert Challen}
\Plaintitle{R6 Generator Maven Plugin: Bridging Java and R6 for Package Development}
\Shorttitle{\proglang{Java} and \proglang{R6}: Compile time integration}

\Abstract{
This article introduces a novel approach to integrating \proglang{Java}
code into \proglang{R}, that offers distinct advantages in terms of ease
of development and maintenance to \proglang{Java} programmers wishing to
expose their libraries as \proglang{R} packages. It builds on the low
level interface provided by the \pkg{rJava} package, \proglang{Java}
code analysis tools, and the \proglang{Maven} compiler framework, to
programmatically generate \proglang{R} package code. The R6 Generator
Maven Plugin provides a Java annotation processor and \proglang{R} code
generator that creates an \proglang{R} package exposing an \pkg{R6}
based interface to \proglang{Java} code. By working at compile time it
ensures the bi-directional transfer of data between R and
\proglang{Java} is type-safe and fast, it allows a simple route to
maintainence of \proglang{R} ports of \proglang{Java} libraries, and it
facilitates package documentation.
}

\Keywords{\proglang{Java}, \proglang{R6}, \proglang{Maven}}
\Plainkeywords{Java, R6, Maven}

%% publication information
%% \Volume{50}
%% \Issue{9}
%% \Month{June}
%% \Year{2012}
%% \Submitdate{}
%% \Acceptdate{2012-06-04}

\Address{
    Robert Challen\\
    University of Exeter\\
    EPSRC Centre for Predictive Modelling in Healthcare, University of
Exeter, Exeter, Devon, UK.\\
  E-mail: \email{rc538@exeter.ac.uk}\\
  URL: \url{https://github.com/terminological/r6-generator-maven-plugin}\\~\\
  }


% Pandoc header
\usepackage{amsmath} \usepackage{minted} \usemintedstyle{emacs} \setminted[java]{fontsize=\footnotesize,tabsize=3} \setminted[xml]{fontsize=\footnotesize,tabsize=3}



\begin{document}

\hypertarget{introduction}{%
\section{Introduction}\label{introduction}}

The R6 Generator Maven Plugin provides a low friction route to
integrating \proglang{Java} code into \proglang{R} programs. \pkg{rJava}
is a low level interface for using \proglang{Java} libraries in
\proglang{R} via the Java Native Interface (JNI). However use of this
low level interface has a steep learning curve for both \proglang{R} and
\proglang{Java} programmers. The \pkg{jsr223} package aims to made to
reduce this friction in the situation where dynamic interaction between
\proglang{R} and \proglang{Java} is needed, by integration of
\proglang{Java} based scripting languages, such as \proglang{Kotlin} or
\proglang{Groovy}. This is a relatively complex solution for the simpler
situation where a developer wishes to package \proglang{Java} based
functions for use in \proglang{R} programs.

Strengths and weaknesses of Java and R R ease of data import and
integration, spatial support R visualisation R data wrangling R REPL
Java ease of multithreaded processing. Java dependency and classpath
management. Java VM debugging versus R debugging

The existing approaches - Integration between \proglang{Java} and
\proglang{R} has existed since the release of \pkg{rJava} in 2003,
however successful use of Java libraries within R has remained complex
and

rJava, rjsr223 jsr223 reference - review of Java integration JNI \&
rJava features and limitations rJava 2 level api jsr223 benefits and
limitations Data only integration e.g.~Apache Arrow.

\hypertarget{use-cases}{%
\section{Use cases}\label{use-cases}}

\begin{itemize}
\tightlist
\item
  Java library development for R use
\item
  Adaption of java library for R use
\end{itemize}

\hypertarget{desiderata-design-rationale}{%
\section{Desiderata / Design
rationale}\label{desiderata-design-rationale}}

R as REPL, java as backend

No knowledge of JNI, rJava or intermediate languages required. High
performance - minimise interpretation, Compile time - strongly typed
inputs to R - minimise data transfer overhead. minimise use of
reflection Accurate data transformations and round trip Dependency
management - Separation of concerns \& isolation - java based API layer
to isolate Java changes from R API changes Predictability - Runtime
library - predictable R data in Java code isolating java from R type
system Seamless R use of library - R6 class hierarchy - native R facade
to Java code

\hypertarget{terminology-and-concepts}{%
\section{Terminology and concepts}\label{terminology-and-concepts}}

Maven plugin - Runtime dependency - R types for java

\hypertarget{feature-documentation}{%
\section{Feature documentation}\label{feature-documentation}}

\hypertarget{minimal-example}{%
\subsection{Minimal example}\label{minimal-example}}

\begin{minted}[linenos]{java}
package uk.co.terminological.rjava.test;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import uk.co.terminological.rjava.RClass;
import uk.co.terminological.rjava.RMethod;
import uk.co.terminological.rjava.types.RDataframe;

/**
 * This class is a very basic example of the features of the rJava maven plugin. <br/>
 * The class is annotated with an @RClass to identify it as part of the R API. <br/>
 */
@RClass
public class MinimalExample {

    static Logger log = LoggerFactory.getLogger(MinimalExample.class);
    
    @RMethod(examples = {
        "J = testRapi::JavaApi$new()",
        "minExample = J$MinimalExample$new()",
        "minExample$demo(dataframe=tibble::tibble(input=c(1,2,3)), message='Hello world')"
    })
    /**
     * Documentation of the method can be done in JavaDoc and these will be present in the R documentation 
     * @param dataframe - a dataframe with an arbitrary number of columns
     * @param message - a message
     * @return the dataframe unchanged
     *  
     */
    public RDataframe demo(RDataframe dataframe, String message) {
        log.info("this dataframe has nrow="+dataframe.nrow());
        log.info(message);
        return dataframe;
    }
    
}
\end{minted}

\begin{minted}[linenos]{xml}
    <properties>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <maven.compiler.source>1.8</maven.compiler.source>
        <maven.compiler.target>1.8</maven.compiler.target>
        <r6.version>master-SNAPSHOT</r6.version>
    </properties>
...
    <dependencies>
        <dependency>
            <groupId>com.github.terminological</groupId>
            <artifactId>r6-generator-runtime</artifactId>
            <version>${r6.version}</version>
        </dependency>
    </dependencies>
...
    <!-- Resolve runtime library on github -->
    <repositories>
        <repository>
            <id>jitpack.io</id>
            <url>https://jitpack.io</url>
        </repository>
    </repositories>

    <!-- Resolve maven plugin on github -->
    <pluginRepositories>
        <pluginRepository>
            <id>jitpack.io</id>
            <url>https://jitpack.io</url>
        </pluginRepository>
    </pluginRepositories>
...
            <plugin>
                <groupId>com.github.terminological</groupId>
                <artifactId>r6-generator-maven-plugin</artifactId>
                <version>${r6.version}</version>
                <configuration>
                    <packageData>
                        <title>A test library</title>
                        <version>0.01</version>
                        <debug>true</debug>
                        <rjavaOpts>
                            <rjavaOpt>-Xmx256M</rjavaOpt>
                        </rjavaOpts>
                        <packageName>testRapi</packageName>
                        <license>MIT</license>
                        <description>An optional long description of the package</description>
                        <maintainerName>test forename</maintainerName>
                        <maintainerFamilyName>optional surname</maintainerFamilyName>
                        <maintainerEmail>test@example.com</maintainerEmail>
                    </packageData>
                    <outputDirectory>${project.basedir}/r-library</outputDirectory>
                </configuration>
                <executions>
                    <execution>
                        <id>generate-r-library</id>
                        <goals>
                            <goal>generate-r-library</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
\end{minted}

\hypertarget{r6-class-generation}{%
\subsection{R6 class generation}\label{r6-class-generation}}

\hypertarget{maven-packaging}{%
\subsection{Maven packaging}\label{maven-packaging}}

\hypertarget{generated-r6-documentation}{%
\subsection{Generated R6
documentation}\label{generated-r6-documentation}}

\hypertarget{datatype-transformation}{%
\subsection{Datatype transformation}\label{datatype-transformation}}

\hypertarget{java-to-r}{%
\subsubsection{Java to R}\label{java-to-r}}

\hypertarget{r-to-java---runtime-library}{%
\subsubsection{R to Java - runtime
library}\label{r-to-java---runtime-library}}

\hypertarget{debugging-java-code}{%
\subsection{Debugging Java code}\label{debugging-java-code}}

\begin{itemize}
\item
  Datasets for testing Java code / serialisation of inputs
\item
\end{itemize}

\hypertarget{benefits}{%
\section{Benefits}\label{benefits}}

\begin{itemize}
\tightlist
\item
  Low friction
\item
  Minimal dependencies introduced.
\item
  Java Library dependency packaging
\item
  Accurate bidirectional transfer of data between R and Java
\item
  Type safety
\item
  Code completion and type hinting in R
\item
  Fluent use of R data in java
\item
  R Documentation
\item
  Separation of concerns
\item
  Maintenance
\end{itemize}

\hypertarget{limitations}{%
\section{Limitations}\label{limitations}}

\begin{itemize}
\tightlist
\item
  Fat Jar bloat
\item
  Recompilation and iterative development
\item
  Naming collisions
\item
  Concurrent use of Multiple rJava libraries
\item
  Java class caching
\end{itemize}

\hypertarget{future-development}{%
\section{Future development}\label{future-development}}

\begin{itemize}
\tightlist
\item
  Tighter integration of multithreading and promises.
\item
  Matrix support
\item
  Named rows in dataframes
\item
  R test case generation
\item
  Java object bindings
\item
  Purrr style lists in data frames
\end{itemize}

\hypertarget{conclusion}{%
\section{Conclusion}\label{conclusion}}



\end{document}


---
documentclass: jss
author:
  - name: Robert Challen
    affiliation: University of Exeter
    address: >
      EPSRC Centre for Predictive Modelling in Healthcare, 
      University of Exeter, 
      Exeter, 
      Devon, UK.
    email: \email{rc538@exeter.ac.uk}
    url: https://github.com/terminological/r6-generator-maven-plugin
title:
  formatted: "R6 Generator Maven Plugin: Bridging \\proglang{Java} and \\proglang{R6} for Package Development"
  plain: "R6 Generator Maven Plugin: Bridging Java and R6 for Package Development"
  # For running headers, if needed
  short:     "\\proglang{Java} and \\proglang{R6}: Compile time integration"
abstract: >
  This article introduces a novel approach to integrating \proglang{Java} code into \proglang{R}, that offers distinct advantages in terms of ease of development and maintenance to \proglang{Java} programmers wishing to expose their libraries as \proglang{R} packages. It builds on the low level interface provided by the \pkg{rJava} package, \proglang{Java} code analysis tools, and the \proglang{Maven} compiler framework, to programmatically generate \proglang{R} package code. The R6 Generator Maven Plugin provides a Java annotation processor and \proglang{R} code generator that creates an \proglang{R} package exposing an \pkg{R6} based interface to \proglang{Java} code. By working at compile time it ensures the bi-directional transfer of data between R and \proglang{Java} is type-safe and fast, it allows a simple route to maintainence of \proglang{R} ports of \proglang{Java} libraries, and it automates package documentation. 
keywords:
  # at least one keyword must be supplied
  formatted: ["\\proglang{Java}", "\\proglang{R6}", "\\proglang{Maven}"]
  plain:     [Java, R6, Maven]
output: rticles::jss_article
header-includes:
  \usepackage{amsmath}
  \usepackage{minted}
  \usemintedstyle{emacs}
  \setminted[java]{fontsize=\footnotesize,tabsize=3}
  \setminted[xml]{fontsize=\footnotesize,tabsize=3}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

source("./codeSnip.R")
```

# Introduction

The R6 Generator Maven Plugin provides a low friction route to integrating \proglang{Java} code into \proglang{R} programs. \pkg{rJava} is a low level interface for using \proglang{Java} libraries in \proglang{R} via the Java Native Interface (JNI). However use of this low level interface has a steep learning curve for both \proglang{R} and \proglang{Java} programmers. The \pkg{jsr223} package aims to made to reduce this friction in the situation where dynamic interaction between \proglang{R} and \proglang{Java} is needed, by integration of \proglang{Java} based scripting languages, such as \proglang{Kotlin} or \proglang{Groovy}. This is a relatively complex solution for the simpler situation where a developer wishes to package \proglang{Java} based functions for use in \proglang{R} programs.

Strengths and weaknesses of Java and R
R ease of data import and integration, spatial support
R visualisation
R data wrangling
R REPL
Java ease of multithreaded processing. 
Java dependency and classpath management.
Java VM debugging versus R debugging

The existing approaches - 
Integration between \proglang{Java} and \proglang{R} has existed since the release of \pkg{rJava} in 2003, however successful use of Java libraries within R has remained complex and 

rJava, rjsr223
jsr223 reference - review of Java integration
JNI & rJava features and limitations
rJava 2 level api
jsr223 benefits and limitations
Data only integration e.g. Apache Arrow.

# Use cases

* Java library development for R use
* Adaption of java library for R use

# Desiderata / Design rationale

R as REPL, java as backend 

No knowledge of JNI, rJava or intermediate languages required.
High performance - minimise interpretation, Compile time - strongly typed inputs to R - minimise data transfer overhead. minimise use of reflection
Accurate data transformations and round trip
Dependency management - 
Separation of concerns & isolation - java based API layer to isolate Java changes from R API changes
Predictability  - Runtime library  - predictable R data in Java code isolating java from R type system
Seamless R use of library - R6 class hierarchy - native R facade to Java code

# Terminology and concepts

Maven plugin - 
Runtime dependency - R types for java

# Feature documentation

## Minimal example

```{r results='asis'}
codeSnip("java",filename="/home/terminological/Git/r6-generator-maven-plugin-test/src/main/java/uk/co/terminological/rjava/test/MinimalExample.java")
```

<!-- \inputminted{java}{/home/terminological/Git/r6-generator-maven-plugin-test/src/main/java/uk/co/terminological/rjava/test/MinimalExample.java} -->

```{r results='asis'}
codeSnip(type="xml",filename="/home/terminological/Git/r6-generator-maven-plugin-test/pom.xml",starts = c(5,19,27,53),ends = c(10,25,41,82), sep = "\n...\n")
```

<!-- \dots -->
<!-- \inputminted[firstline=6, lastline=11]{xml}{/home/terminological/Git/r6-generator-maven-plugin-test/pom.xml} -->
<!-- \dots -->
<!-- \inputminted[firstline=21, lastline=27]{xml}{/home/terminological/Git/r6-generator-maven-plugin-test/pom.xml} -->
<!-- \dots -->
<!-- \inputminted[firstline=55, lastline=84]{xml}{/home/terminological/Git/r6-generator-maven-plugin-test/pom.xml} -->
<!-- \dots -->




## R6 class generation

```{r, include=FALSE}
fs::dir_tree(path = "/home/terminological/Git/r6-generator-maven-plugin-test/r-library/", recurse = TRUE)
```
## Maven packaging
## Generated R6 documentation
## Datatype transformation
### Java to R
### R to Java - runtime library
## Debugging Java code
* Datasets for testing Java code / serialisation of inputs
* 


# Benefits

* Low friction
* Minimal dependencies introduced.
* Java Library dependency packaging
* Accurate bidirectional transfer of data between R and Java
* Type safety
* Code completion and type hinting in R
* Fluent use of R data in java 
* R Documentation
* Separation of concerns
* Maintenance

# Limitations

* Fat Jar bloat
* Recompilation and iterative development
* Naming collisions
* Concurrent use of Multiple rJava libraries
* Java class caching 

# Future development

* Tighter integration of multithreading and promises.
* Matrix support
* Named rows in dataframes
* R test case generation
* Java object bindings
* Purrr style lists in data frames

# Conclusion

# References
